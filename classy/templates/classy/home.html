{% load static %}
{% include 'classy/head.html' %}
<title>Homepage - Classy</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.bundle.js"></script>
</head>
<body>

{% include 'classy/navbar.html' %}

    <div id="topicTemplate" class="template container gov-container">
        <!-- Header with Background Image -->
        <div class="row">
            <header class="">
                <div class="">
                    <h2 class="display-4 text-center mt-4">Welcome {{user.first_name}}</h2>
                    <img class="col-xs-12" src="https://placehold.it/2500x500">
                </div>
            </header>
        </div>
        <div class="row">
            <div class="col-md-12">
                <canvas id="lineChart"></canvas>
            </div>
        </div>
        <!-- Page Content -->
        <div class="row">
            <div class="col-lg-6">
                <h2 class="mt-4">About this application</h2>
                <p>The Data Security Classification repository, known as DSC for short, is a tool developed by the Corporate Services for the Natural Resource ministries with 
    the purpose of keeping an inventory of the data that is managed, and where that data is stored. This tool will allow users to view high level information about 
      tables, modify table classifications, upload new information, and flag deprecated data</p>

                <p>This tool is managed by the FLNR security team, with custom access granted to business areas based on privilege. All changes will be reviewed and approved before 
        they reflect in the main dataset. If you need access to a larger dataset due to business changes, please send a request to 
     the FLNR security team.
            </div>
            <div class="col-lg-6">
                {% if not empty %}
                <canvas id="pieChart"></canvas>
                {% endif %}
            </div>
        </div>
        <div class="row">
            <div class="col-sm-4 my-4" style="padding-top:25px; ">
                <div class="panel">
                    <img class="panel-header img-thumbnail img-responsive center-block" src="https://www.nps.gov/whsa/learn/nature/images/mountain_pepperweed.JPG" alt="">
                    <div class="panel-body">
                        <h4 class="card-title">Getting Started</h4>
                        <p class="card-text">Lost and not sure where to start? This page will give you a quick overview of DSC's main functionality.</p>
                    </div>
                    <div class="panel-footer">
                        <a href="tutorial" target="_blank" class="btn btn-info">Tutorial</a>
                    </div>
                </div>
            </div>
            <div class="col-sm-4 my-4" style="padding-top:25px;">
                <div class="panel">
                    <img class="panel-header img-thumbnail img-responsive center-block" src="https://www.nps.gov/whsa/learn/nature/images/cottonwood.JPG" alt="">
                    <div class="panel-body">
                        <h4 class="card-title">Classification information</h4>
                        <p class="card-text">Confused as to what the different classifications mean? Take a look at our Classification guide for examples, and in-depth descriptions.</p>
                    </div>
                    <div class="panel-footer">
                        <a href="" class="btn btn-info">Classifications</a>
                    </div>
                </div>
            </div>
            <div class="col-sm-4 my-4" style="padding-top:25px;">
                <div class="panel">
                    <img class="panel-header img-thumbnail img-responsive center-block" src="https://www.nps.gov/seki/learn/nature/images/Sheep-WF-small.jpg" alt="">
                    <div class="panel-body">
                        <h4 class="card-title">Issues</h4>
                        <p class="card-text">Found an issue in this application? Please take the time to send me a message using the link below.</p>
                    </div>
                    <div class="panel-footer">
                        <a href="https://github.com/Krocodial/DSC/issues" target="_blank" class="btn btn-info">Bugtracker</a>
                    </div>
                </div>
            </div>
        </div>
    <!-- /.row -->

    </div>
{% include 'classy/tail.html' %}
<script>
var config = {
        type: 'line',
        data: {
                labels: {{dates|safe}},
                datasets: [{
                        label: 'Unclassified',
                        backgroundColor: '#bca9b6',
                        borderColor: '#94778B',
                        pointBackgroundColor: '#94778B',
                        pointBorderColor: '#fff',
                        pointHoverBorderColor: '#94778B',
                        data: 
                {{unc}}
                        ,
                        fill: 'origin',
                        }, {
                        label: 'Public',
                        backgroundColor: '#adefa9',
                        borderColor: '#7CE577',
                        pointBackgroundColor: '#7CE577',
                        pointBorderColor: '#fff',
                        pointHoverBorderColor: '#7CE577',
                        data: {{pub}},
                        fill: '-1',
                        }, {
                        label: 'Confidential',
                        backgroundColor: '#c8e2ea',
                        borderColor: '#A0CCDA',
                        data: {{conf}},
                        fill: '-1',
                        }, {
                        label: 'Protected A',
                        backgroundColor: '#f5e9a3',
                        borderColor: '#E9CE2C',
                        data: {{prota}},
                        fill: '-1',
                        }, {
                        label: 'Protected B',
                        backgroundColor: '#f3bba5',
                        borderColor: '#DE541E',
                        data: {{protb}},
                        fill: '-1',
                        }, {
                        label: 'Protected C',
                        backgroundColor: '#f1a8a7',
                        borderColor: '#BF211E',
                        data: {{protc}},
                        fill: '-1',
                        }]
                },
                options: {
                        elements: {
                        },
                        legend: {
                                display: true,
                                position: 'bottom',
                        },
                        responsive: true,
            maintainAspectRatio: true,
            aspectRatio: '5',
            onResize: lineResizing,
                        title: {
                                display: true,
                text: 'Activity over last 2 months',
                position: 'top',
                fontSize: '13'
                        },
                        tooltips: {
                                mode: 'index',
                                intersect: false,
                        },
                        hover: {
                                mode: 'nearest',
                                intersect: true
                        },
                        scales: {
                                xAxes: [{
                                        display: false,
                                        scaleLabel: {
                                                display: true,
                                                labelString: 'Date'
                                        }
                                }],
                                yAxes: [{
                                        stacked: true,
                                        display: true,
                                        scaleLabel: {
                                                display: true,
                                                labelString: 'Rows'
                                        }
                                }]
                        }
                }
        };

{% if not empty %}
piedata = {
    datasets: [{
        data: {{data_cons}},

        backgroundColor: [
        '#94778B',
                '#7CE577',
        '#A0CCDA',
                '#E9CE2C',
                '#DE541E',
                '#BF211E'
        ]

    }],

    // These labels appear in the legend and in the tooltips when hovering different arcs
    labels: {{label_cons}}
};

pieoptions = {
        legend: {
                display: true,
                position: 'left',
        },
    title: {
        display: true,
        position: 'top',
        text: 'Breakdown of classifications',
        fontSize: '13'
    },
    //responsive: true,
    onResize: afterResizing,
};


var pie = document.getElementById('pieChart').getContext('2d');
{% endif %}
var line = document.getElementById('lineChart').getContext('2d');

window.onload = function() {
    window.myLine = new Chart(line, config);
    var size = {width: window.myLine.width};
    lineResizing(window.myLine, size);
    {% if not empty %}
    var myDoughnutChart = new Chart(pie, {
        type: 'doughnut',
        data: piedata,
        options: pieoptions
    });
    var size = {width: myDoughnutChart.width};
    afterResizing(myDoughnutChart, size);
    {% endif %}
};
function lineResizing(chart, size){
    console.log(chart, size);
    console.log(size.width);
    if(size.width <=1000) {
        $("#lineChart").hide();
    } else {
        $("#lineChart").show();
        //chart.options.legend.display=true;
    }
    chart.update()
};

function afterResizing(chart, size){
    if(size.width <=530) {
        chart.options.legend.display=false;
    } else {
        chart.options.legend.display=true;
    }
    chart.update()
};
</script>
</body>
</html>
